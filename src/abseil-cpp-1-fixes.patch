From 5059a1465f1b271071bb6f2d96f3839d327e2347 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?=D9=85=D9=87=D8=AF=D9=8A=20=D8=B4=D9=8A=D9=86=D9=88=D9=86?=
 =?UTF-8?q?=20=28Mehdi=20Chinoune=29?= <mehdi.chinoune@hotmail.com>
Date: Tue, 26 Sep 2023 23:43:43 +0100
Subject: [PATCH 1/2] Link to required libraries on MinGW-w64

---
 CMake/AbseilDll.cmake | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/CMake/AbseilDll.cmake b/CMake/AbseilDll.cmake
index c943814eb40..7b80ab6b150 100644
--- a/CMake/AbseilDll.cmake
+++ b/CMake/AbseilDll.cmake
@@ -726,7 +726,11 @@ function(absl_make_dll)
   else()
     set(_dll "abseil_dll")
     set(_dll_files ${ABSL_INTERNAL_DLL_FILES})
-    set(_dll_libs "")
+    if (MINGW)
+      set(_dll_libs "Threads::Threads" "bcrypt" "dbghelp")
+    else()
+      set(_dll_libs "")
+    endif()
     set(_dll_compile_definitions "")
     set(_dll_includes "")
     set(_dll_consume "ABSL_CONSUME_DLL")

From 857e91cd84066bb901c144723d6375755faf25ab Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?=D9=85=D9=87=D8=AF=D9=8A=20=D8=B4=D9=8A=D9=86=D9=88=D9=86?=
 =?UTF-8?q?=20=28Mehdi=20Chinoune=29?= <mehdi.chinoune@hotmail.com>
Date: Tue, 26 Sep 2023 23:45:36 +0100
Subject: [PATCH 2/2] Use pthread_waiter on MinGW-w64

For unknown reason It fails to link?
---
 absl/synchronization/internal/pthread_waiter.h | 2 +-
 absl/synchronization/internal/win32_waiter.h   | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/absl/synchronization/internal/pthread_waiter.h b/absl/synchronization/internal/pthread_waiter.h
index 206aefa47c0..fe7285c83e8 100644
--- a/absl/synchronization/internal/pthread_waiter.h
+++ b/absl/synchronization/internal/pthread_waiter.h
@@ -16,7 +16,7 @@
 #ifndef ABSL_SYNCHRONIZATION_INTERNAL_PTHREAD_WAITER_H_
 #define ABSL_SYNCHRONIZATION_INTERNAL_PTHREAD_WAITER_H_
 
-#ifndef _WIN32
+#ifndef _MSC_VER
 #include <pthread.h>
 
 #include "absl/base/config.h"
diff --git a/absl/synchronization/internal/win32_waiter.h b/absl/synchronization/internal/win32_waiter.h
index 87eb617cbd1..9986abe467e 100644
--- a/absl/synchronization/internal/win32_waiter.h
+++ b/absl/synchronization/internal/win32_waiter.h
@@ -20,7 +20,7 @@
 #include <sdkddkver.h>
 #endif
 
-#if defined(_WIN32) && _WIN32_WINNT >= _WIN32_WINNT_VISTA
+#if defined(_MSC_VER) && _WIN32_WINNT >= _WIN32_WINNT_VISTA
 
 #include "absl/base/config.h"
 #include "absl/synchronization/internal/kernel_timeout.h"
